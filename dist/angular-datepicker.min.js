!function(e,t){"use strict";var n;n="object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("angular"),require("moment")):"function"==typeof define&&define.amd?define(["angular","moment"],t):t(e.angular,e.moment)}(this,function(e,t){var n=e.module("datePicker",[]);n.constant("datePickerConfig",{template:"templates/datepicker.html",view:"month",views:["year","month","date","hours","minutes"],momentNames:{year:"year",month:"month",date:"day",hours:"hours",minutes:"minutes"},viewConfig:{year:["years","isSameYear"],month:["months","isSameMonth"],hours:["hours","isSameHour"],minutes:["minutes","isSameMinutes"]},step:5}),n.filter("mFormat",function(){return function(e,n,i){return t.isMoment(e)?i?t.tz(e,i).format(n):e.format(n):e?t(e).format(n):""}}),n.directive("datePicker",["datePickerConfig","datePickerUtils",function(n,i){return{require:"?ngModel",template:'<div ng-include="template"></div>',scope:{model:"=datePicker",after:"=?",before:"=?"},link:function(a,r,s,d){function o(){a.views=n.views.concat(),a.view=s.view||n.view,a.views=a.views.slice(a.views.indexOf(s.maxView||"year"),a.views.indexOf(s.minView||"minutes")+1),(1===a.views.length||-1===a.views.indexOf(a.view))&&(a.view=a.views[0])}function c(e){return i.getDate(a,s,e)}function u(){var e=a.view;i.setParams(k,Y),a.model&&!w&&(a.date=y(a.model),w=!1);var t=a.date;switch(e){case"year":a.years=i.getVisibleYears(t);break;case"month":a.months=i.getVisibleMonths(t);break;case"date":a.weekdays=a.weekdays||i.getDaysOfWeek(),a.weeks=i.getVisibleWeeks(t);break;case"hours":a.hours=i.getVisibleHours(t);break;case"minutes":a.minutes=i.getVisibleMinutes(t,D)}f()}function m(){return"date"!==a.view?a.view:a.date?a.date.month():null}var l,f,h,p,v,g,w=!1,k=a.tz=s.timezone,y=i.createMoment,b=i.eventIsForPicker,D=parseInt(s.step||n.step,10),x=!!s.partial,M=c("minDate"),$=c("maxDate"),V=r[0].id,C=a.now=y(),P=a.date=y(a.model||C),S="true"===s.autoClose,Y=s.firstDay&&s.firstDay>=0&&s.firstDay<=6?parseInt(s.firstDay,10):t().weekday(0).day();i.setParams(k,Y),a.model||P.minute(Math.ceil(P.minute()/D)*D).second(0),a.template=s.template||n.template,a.watchDirectChanges=void 0!==s.watchDirectChanges,a.callbackOnSetDate=s.dateChange?i.findFunction(a,s.dateChange):void 0,o(),a.setView=function(e){-1!==a.views.indexOf(e)&&(a.view=e)},a.selectDate=function(e){if(s.disabled)return!1;if(h(a.date,e)&&(e=a.date),e=p(e),!e)return!1;a.date=e;var t=a.views[a.views.indexOf(a.view)+1];(!t||x||a.model)&&l(e),t?a.setView(t):S?(r.addClass("hidden"),a.$emit("hidePicker")):f()},l=function(e){e&&(a.model=e,d&&d.$setViewValue(e)),a.$emit("setDate",a.model,a.view),a.callbackOnSetDate&&a.callbackOnSetDate(s.datePicker,a.date)},a.$watch(m,u),a.watchDirectChanges&&a.$watch("model",function(){w=!1,u()}),f=function(){var e,t,r=a.view,s=a.date,d=[],o="";if(i.setParams(k,Y),"date"===r){var c,u=a.weeks;for(e=0;e<u.length;e++)for(c=u[e],d.push([]),t=0;t<c.length;t++)o="",i.isSameDay(s,c[t])&&(o+="active"),v(c[t],r)&&(o+=" now"),c[t].month()===s.month()&&g(c[t])||(o+=" disabled"),d[e].push(o)}else{var m=n.viewConfig[r],l=a[m[0]],f=m[1];for(e=0;e<l.length;e++)o="",i[f](s,l[e])&&(o+="active"),v(l[e],r)&&(o+=" now"),g(l[e])||(o+=" disabled"),d.push(o)}a.classes=d},a.next=function(e){var n=t(a.date);switch(e=e||1,a.view){case"year":case"month":n.year(n.year()+e);break;case"date":n.month(n.month()+e);break;case"hours":case"minutes":n.hours(n.hours()+e)}n=p(n),n&&(a.date=n,w=!0,u())},g=function(e){var t=!0;return M&&M.isAfter(e)&&(t=h(M,e)),$&&$.isBefore(e)&&(t&=h($,e)),t},h=function(e,t){return e.isSame(t,n.momentNames[a.view])?!0:!1},p=function(e){return M&&M.isAfter(e)?M:$&&$.isBefore(e)?$:e},v=function(e,t){var n=!0;switch(t){case"minutes":n&=~~(C.minutes()/D)===~~(e.minutes()/D);case"hours":n&=C.hours()===e.hours();case"date":n&=C.date()===e.date();case"month":n&=C.month()===e.month();case"year":n&=C.year()===e.year()}return n},a.prev=function(e){return a.next(-e||-1)},V&&a.$on("pickerUpdate",function(t,n,i){if(b(n,V)){var a=!1,r=!1;e.isDefined(i.minDate)&&(M=i.minDate?i.minDate:!1,r=!0),e.isDefined(i.maxDate)&&($=i.maxDate?i.maxDate:!1,r=!0),e.isDefined(i.minView)&&(s.minView=i.minView,a=!0),e.isDefined(i.maxView)&&(s.maxView=i.maxView,a=!0),s.view=i.view||s.view,a&&o(),r&&u()}})}}}]),e.module("datePicker").factory("datePickerUtils",function(){var n,i,a=function(e,i,a,r,s){var d=Date.UTC(0|e,0|i,0|a,0|r,0|s);return n?t.tz(d,n):t(d)};return{getVisibleMinutes:function(e,t){var n,i,r=e.year(),s=e.month(),d=e.date(),o=e.hours(),c=e.utcOffset()/60,u=[];for(i=0;60>i;i+=t)n=a(r,s,d,o-c,i),u.push(n);return u},getVisibleWeeks:function(e){e=t(e);var n=e.year(),a=e.month();e.date(1);var r=e.day();e.date(i-(r+(i>=r?6:-1)));for(var s=[];s.length<6&&!(e.year()===n&&e.month()>a);)s.push(this.getDaysOfWeek(e)),e.add(7,"d");return s},getVisibleYears:function(e){var n=t(e),i=n.year();n.year(i-i%10),i=n.year();for(var r,s,d=n.utcOffset()/60,o=[],c=0;12>c;c++)r=a(i,0,1,0-d),s=r.utcOffset()/60,s!==d&&(r=a(i,0,1,0-s),d=s),o.push(r),i++;return o},getDaysOfWeek:function(e){e=e?e:n?t.tz(n).day(i):t().day(i);for(var r,s,d=e.year(),o=e.month(),c=e.date(),u=[],m=e.utcOffset()/60,l=0;7>l;l++)r=a(d,o,c,0-m,0,!1),s=r.utcOffset()/60,s!==m&&(r=a(d,o,c,0-s,0,!1)),u.push(r),c++;return u},getVisibleMonths:function(e){for(var t,n,i=e.year(),r=e.utcOffset()/60,s=[],d=0;12>d;d++)t=a(i,d,1,0-r,0,!1),n=t.utcOffset()/60,n!==r&&(t=a(i,d,1,0-n,0,!1)),s.push(t);return s},getVisibleHours:function(e){var t,n,i,r=e.year(),s=e.month(),d=e.date(),o=[],c=e.utcOffset()/60;for(t=0;24>t;t++)n=a(r,s,d,t-c,0,!1),i=n.utcOffset()/60,i!==c&&(n=a(r,s,d,t-i,0,!1)),o.push(n);return o},isAfter:function(e,t){return e&&e.unix()>=t.unix()},isBefore:function(e,t){return e.unix()<=t.unix()},isSameYear:function(e,t){return e&&e.year()===t.year()},isSameMonth:function(e,t){return this.isSameYear(e,t)&&e.month()===t.month()},isSameDay:function(e,t){return this.isSameMonth(e,t)&&e.date()===t.date()},isSameHour:function(e,t){return this.isSameDay(e,t)&&e.hours()===t.hours()},isSameMinutes:function(e,t){return this.isSameHour(e,t)&&e.minutes()===t.minutes()},setParams:function(e,t){n=e,i=t},scopeSearch:function(e,t,n){var i,a,r=e,s=t.split("."),d=s.length;do{for(i=r=r.$parent,a=0;d>a;a++){i=i[s[a]]}if(i&&n(i))return i}while(r.$parent);return!1},findFunction:function(t,n){return this.scopeSearch(t,n,function(t){return e.isFunction(t)})},findParam:function(e,t){return this.scopeSearch(e,t,function(){return!0})},createMoment:function(e){return n?t.tz(e,n):t.isMoment(e)?t.unix(e.unix()):t(e)},getDate:function(e,t,n){var i=!1;return t[n]&&(i=this.createMoment(t[n]),i.isValid()||(i=this.findParam(e,t[n]),i&&(i=this.createMoment(i)))),i},eventIsForPicker:function(t,n){return e.isArray(t)&&t.indexOf(n)>-1||t===n}}});var n=e.module("datePicker");n.directive("dateRange",["$compile","datePickerUtils","dateTimeConfig",function(n,i,a){function r(n,i,r,s,d){return a.template(e.extend(n,{ngModel:r,minDate:s&&t.isMoment(s)?s.format():!1,maxDate:d&&t.isMoment(d)?d.format():!1}),i)}function s(){return"picker"+Math.random().toString().substr(2)}return{scope:{start:"=",end:"="},link:function(t,a,d){function o(e){t.$broadcast("pickerUpdate",l[0],{maxDate:e})}function c(e){t.$broadcast("pickerUpdate",l[1],{minDate:e})}var u=null,m=a[0].id,l=[s(),s()],f=i.createMoment,h=i.eventIsForPicker;t.dateChange=function(e,t){u&&u(e,t)},m&&t.$on("pickerUpdate",function(e,n,i){h(n,m)&&t.$broadcast("pickerUpdate",l,i)}),i.setParams(d.timezone),t.start=f(t.start),t.end=f(t.end),t.$watchGroup(["start","end"],function(e){c(e[0]),o(e[1])}),e.isDefined(d.dateChange)&&(u=i.findFunction(t,d.dateChange)),d.onSetDate="dateChange";var p='<div><table class="date-range"><tr><td valign="top">'+r(d,l[0],"start",!1,t.end)+'</td><td valign="top">'+r(d,l[1],"end",t.start,!1)+"</td></tr></table></div>",v=n(p)(t);a.append(v)}}}]);var i="ng-pristine",a="ng-dirty",n=e.module("datePicker");n.constant("dateTimeConfig",{template:function(e,t){return"<div "+(t?'id="'+t+'" ':"")+'date-picker="'+e.ngModel+'" '+(e.view?'view="'+e.view+'" ':"")+(e.maxView?'max-view="'+e.maxView+'" ':"")+(e.maxDate?'max-date="'+e.maxDate+'" ':"")+(e.autoClose?'auto-close="'+e.autoClose+'" ':"")+(e.template?'template="'+e.template+'" ':"")+(e.minView?'min-view="'+e.minView+'" ':"")+(e.minDate?'min-date="'+e.minDate+'" ':"")+(e.partial?'partial="'+e.partial+'" ':"")+(e.step?'step="'+e.step+'" ':"")+(e.onSetDate?'date-change="'+e.onSetDate+'" ':"")+(e.ngModel?'ng-model="'+e.ngModel+'" ':"")+(e.firstDay?'first-day="'+e.firstDay+'" ':"")+(e.timezone?'timezone="'+e.timezone+'" ':"")+'class="date-picker-date-time"></div>'},format:"YYYY-MM-DD HH:mm",views:["date","year","month","hours","minutes"],autoClose:!1,position:"relative"}),n.directive("dateTimeAppend",function(){return{link:function(e,t){t.bind("click",function(){t.find("input")[0].focus()})}}}),n.directive("dateTime",["$compile","$document","$filter","dateTimeConfig","$parse","datePickerUtils",function(n,r,s,d,o,c){var u=r.find("body"),m=s("mFormat");return{require:"ngModel",scope:!0,link:function(r,s,l,f){function h(e){return m(e,x,U)}function p(e){return e.length===x.length?e:0===e.length?e:void 0}function v(e){F=e,l.minDate=e?e.format():e,q=t.isMoment(e)}function g(e){H=e,l.maxDate=e?e.format():e,T=t.isMoment(e)}function w(){D=d.template(l)}function k(e){e.stopPropagation(),f.$pristine&&(f.$dirty=!0,f.$pristine=!1,s.removeClass(i).addClass(a),M&&M.$setDirty(),f.$render())}function y(){S&&(S.remove(),S=null),z&&(z.remove(),z=null)}function b(){if(!S){if(S=n(D)(r),r.$digest(),I||(r.$on("setDate",function(e,t,n){k(e),B&&B(l.ngModel,t),P&&$[$.length-1]===n&&y()}),r.$on("hidePicker",function(){s[0].blur()}),r.$on("$destroy",y),I=!0),"absolute"===O){var t=s[0].getBoundingClientRect(),i=t.height||s[0].offsetHeight;S.css({top:t.top+i+"px",left:t.left+"px",display:"block",position:O}),u.append(S)}else z=e.element("<div date-picker-wrapper></div>"),s[0].parentElement.insertBefore(z[0],s[0]),z.append(S),S.css({top:s[0].offsetHeight+"px",display:"block"});S.bind("mousedown",function(e){e.preventDefault()})}}var D,x=l.format||d.format,M=s.inheritedData("$formController"),$=o(l.views)(r)||d.views.concat(),V=l.view||$[0],C=$.indexOf(V),P=l.autoClose?o(l.autoClose)(r):d.autoClose,S=null,Y=s[0].id,O=l.position||d.position,z=null,F=null,q=null,H=null,T=null,U=l.timezone||!1,A=c.eventIsForPicker,B=null,I=!1;-1===C&&$.splice(C,1),$.unshift(V),f.$formatters.push(h),f.$parsers.unshift(p),e.isDefined(l.minDate)&&(v(c.findParam(r,l.minDate)),f.$validators.min=function(e){return q?t.isMoment(e)&&(F.isSame(e)||F.isBefore(e)):!0}),e.isDefined(l.maxDate)&&(g(c.findParam(r,l.maxDate)),f.$validators.max=function(e){return T?t.isMoment(e)&&(H.isSame(e)||H.isAfter(e)):!0}),e.isDefined(l.dateChange)&&(B=c.findFunction(r,l.dateChange)),Y&&r.$on("pickerUpdate",function(t,n,i){if(A(n,Y))if(S);else{var a=!1;e.isDefined(i.minDate)&&(v(i.minDate),a=!0),e.isDefined(i.maxDate)&&(g(i.maxDate),a=!0),e.isDefined(i.minView)&&(l.minView=i.minView),e.isDefined(i.maxView)&&(l.maxView=i.maxView),l.view=i.view||l.view,a&&f.$validate(),e.isDefined(i.format)&&(x=l.format=i.format||d.format,f.$modelValue=-1),w()}}),s.bind("focus",b),s.bind("click",b),s.bind("blur",y),w()}}}]),e.module("datePicker").run(["$templateCache",function(e){e.put("templates/datepicker.html",'<div ng-switch="view">\r\n  <div class="beforeTable" ng-switch-when="date">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th colspan="9" class="switch" ng-click="setView(\'month\')" ng-bind="date|mFormat:\'YYYY MMMM\':tz"></th>\r\n      </tr>\r\n      <tr>\r\n<th></th>        <th ng-repeat="day in weekdays" style="overflow: hidden" ng-bind="day|mFormat:\'ddd\':tz"></th>\r\n<th></th>      </tr>\r\n      </thead>\r\n      <tbody>\r\n<tr><td rowspan="7" ><div class="datepicker-navigation" ng-click="prev()">&lsaquo;</div></td>\r<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td rowspan="7"><div class="datepicker-navigation last" ng-click="next()">&rsaquo;</div></td>\r</tr>      <tr ng-repeat="week in weeks" ng-init="$index2 = $index">\r\n        <td ng-repeat="day in week">\r\n          <span\r\n            ng-class="classes[$index2][$index]"\r\n            ng-click="selectDate(day)" ng-bind="day|mFormat:\'DD\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div class="beforeTable" ng-switch-when="year">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th colspan="9" class="switch"ng-bind="years[0].year()+\' - \'+years[years.length-1].year()"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n<tr><td rowspan="7" ><div class="datepicker-navigation" ng-click="prev()">&lsaquo;</div></td>\r<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td rowspan="7" ><div class="datepicker-navigation last" ng-click="next()">&rsaquo;</div></td>\r</tr>      <tr>\r\n        <td colspan="7">\r\n          <span ng-class="classes[$index]"\r\n                ng-repeat="year in years"\r\n                ng-click="selectDate(year)" ng-bind="year.year()"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div class="beforeTable" ng-switch-when="month">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th colspan="9" class="switch" ng-click="setView(\'year\')" ng-bind="date|mFormat:\'YYYY\':tz"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n<tr><td rowspan="7" ><div class="datepicker-navigation" ng-click="prev()">&lsaquo;</div></td>\r<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td rowspan="7" ><div class="datepicker-navigation last" ng-click="next()">&rsaquo;</div></td>\r</tr>      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="month in months"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(month)"\r\n                ng-bind="month|mFormat:\'MMM\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div class="beforeTable" ng-switch-when="hours">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th colspan="9" class="switch" ng-click="setView(\'date\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n<tr><td rowspan="7" ><div class="datepicker-navigation" ng-click="prev()">&lsaquo;</div></td>\r<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td rowspan="7" ><div class="datepicker-navigation last" ng-click="next()">&rsaquo;</div></td>\r</tr>      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="hour in hours"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(hour)" ng-bind="hour|mFormat:\'HH:mm\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n  <div class="beforeTable" ng-switch-when="minutes">\r\n    <table>\r\n      <thead>\r\n      <tr>\r\n        <th colspan="9" class="switch" ng-click="setView(\'hours\')" ng-bind="date|mFormat:\'DD MMMM YYYY\':tz"></th>\r\n      </tr>\r\n      </thead>\r\n      <tbody>\r\n<tr><td rowspan="7" ><div class="datepicker-navigation" ng-click="prev()">&lsaquo;</div></td>\r<td></td><td></td><td></td><td></td><td></td><td></td><td></td><td rowspan="7" ><div class="datepicker-navigation last" ng-click="next()">&rsaquo;</div></td>\r</tr>      <tr>\r\n        <td colspan="7">\r\n          <span ng-repeat="minute in minutes"\r\n                ng-class="classes[$index]"\r\n                ng-click="selectDate(minute)"\r\n                ng-bind="minute|mFormat:\'HH:mm\':tz"></span>\r\n        </td>\r\n      </tr>\r\n      </tbody>\r\n    </table>\r\n  </div>\r\n</div>')}])});
